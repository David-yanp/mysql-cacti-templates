#summary How to upgrade between template versions

<wiki:toc />

Upgrading is normally a simple process.

= Finding The Installed Version =

Before you begin, find the version of the templates and scripts that is currently installed.  In releases 1.1.4 and higher, you can find this as a GPRINT item, as in the following screenshot:

http://sites.google.com/site/bettercactitemplates/Home/mysql-cacti-templates-installed-version.png

This shows that the MySQL templates installed were generated from version 1.1.4 of the templates, against version 1.1.4 of the PHP script file.  If you don't see this, the templates installed were from version 1.1.3 or earlier.

Check the installed scripts for their version:

{{{
# grep ^.version /path/to/ss_get_mysql_stats.php
$version = "1.1.4";
}}}

Each step in the following list assumes that you have upgraded to the previous version already.

= Version 1.1.5 =

To upgrade from version 1.1.4, you need to copy the new ss_get_mysql_stats.php and ss_get_by_ssh.php files into your Cacti scripts directory, and re-import the new version of the templates.  All of the templates were changed.  You do not need to re-edit devices, because there are no new graphs.  However, the RRA definitions are changed to use DERIVE instead of COUNTER, and the RRA files need to be rebuilt for that to take effect.  This is optional, but is a nice improvement because it will prevent spikes from making the graphs unreadable.  To rebuild the RRA files with DERIVE, run the following code in your RRA directory, which is probably something like `/var/lib/cacti/rra/`:

{{{
for file in *.rrd; do
  if rrdtool info $file | grep -q COUNTER; then
    mv $file $file.bak;
    rrdtool dump $file.bak > $file.xml;
    perl -pi -e 's/COUNTER/DERIVE/' $file.xml;
    rrdtool restore $file.xml $file;
    rm $file.xml;
  fi
done
}}}

You should then test that everything is OK.  If needed, the original files are still there with a .bak filename extension.  These can be deleted after you determine everything's all right.

= Version 1.1.4 =

To upgrade from version 1.1.3, you need to copy the new ss_get_mysql_stats.php and ss_get_by_ssh.php files into your Cacti scripts directory, and re-import the MySQL templates.  (Only the MySQL templates were changed.)  You should then edit all devices that have the MySQL template attached.  You probably need to change their host template to None, then back to X MySQL Server HT, and then create new graphs.

= Version 1.1.3 =

To upgrade from version 1.1.2, you need to copy the new ss_get_mysql_stats.php file into your Cacti scripts directory.

= Version 1.1.2 =

Upgrade instructions from versions prior to 1.1.2 might be more complicated, because there were some incompatible changes.  (This is not likely to happen again.)  You might find this article useful: http://www.xaprb.com/blog/2009/10/15/a-tip-when-upgrading-mysql-cacti-templates/